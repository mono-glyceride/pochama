<%= render  'shared/error_messages' %>
<%= render "shared/header" %>
<div class="form-container">
  <%= form_with model: @post do |form| %>
    <div class="form-header">
      <button id="form-cancel-button">キャンセル</button>
      <span id="form-notice">位置情報を取得中...</span>
      <button id="form-submit-button" type="submit">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <path d="M10 14l11 -11"></path>
          <path d="M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5"></path>
        </svg>
      </button>
    </div>
    <div class="form-main">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mood-smile-filled" width="40" height="40" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M17 3.34a10 10 0 1 1 -14.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 14.995 -8.336zm-1.8 10.946a1 1 0 0 0 -1.414 .014a2.5 2.5 0 0 1 -3.572 0a1 1 0 0 0 -1.428 1.4a4.5 4.5 0 0 0 6.428 0a1 1 0 0 0 -.014 -1.414zm-6.19 -5.286l-.127 .007a1 1 0 0 0 .117 1.993l.127 -.007a1 1 0 0 0 -.117 -1.993zm6 0l-.127 .007a1 1 0 0 0 .117 1.993l.127 -.007a1 1 0 0 0 -.117 -1.993z" stroke-width="0" fill="currentColor"></path>
      </svg>
      <div class="form-message-wrapper">
        <div class="form-user-address">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-map-pin-filled" width="40" height="40" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path d="M18.364 4.636a9 9 0 0 1 .203 12.519l-.203 .21l-4.243 4.242a3 3 0 0 1 -4.097 .135l-.144 -.135l-4.244 -4.243a9 9 0 0 1 12.728 -12.728zm-6.364 3.364a3 3 0 1 0 0 6a3 3 0 0 0 0 -6z" stroke-width="0" fill="currentColor"></path>
          </svg>
          京都市・中京区
        </div>
        <%= form.text_area :content, placeholder: "\"今いる場所\" でのできごとを共有しよう。", id: "form-message" %>
      </div>
    </div>
    <%= form.hidden_field :longitude, id: "form-longitude", value: "" %>
    <%= form.hidden_field :latitude, id: "form-latitude", value: "" %>
  <% end %>
  <input type="file" id="file-input" accept="image/*" style="display: none;">
  <label for="file-input" id="upload-icon">
  <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-camera-plus" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M12 20h-7a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2h1a2 2 0 0 0 2 -2a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v3.5"></path>
   <path d="M16 19h6"></path>
   <path d="M19 16v6"></path>
   <path d="M9 13a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"></path>
</svg>
  </label>  
</div>
<script>
  var coordsReady = false;
  var isValidMsg = false;

  var cancelButton = document.querySelector("#form-cancel-button");
  cancelButton.addEventListener("click", (e) => {
    e.preventDefault();
    window.history.back();
  });

  var submitButton = document.querySelector("#form-submit-button");
  submitButton.disabled = true;
  submitButton.value = ``

  var noticeMsg = document.querySelector("#form-notice");

  navigator.geolocation.getCurrentPosition((position) => {
    document.querySelector("#form-longitude").value = position.coords.longitude;
    document.querySelector("#form-latitude").value = position.coords.latitude;

    submitButton.disabled = false;
    noticeMsg.innerHTML = "";

    coordsReady = true;

    if (isValidMsg) {
      submitButton.disabled = false;
    } else {
      submitButton.disabled = true;
    }
  });

  var msgInput = document.querySelector("#form-message");
  msgInput.addEventListener("input", (e) => {
    var msg = e.target.value;
    if (msg.length > 0) {
      isValidMsg = true;
    } else {
      isValidMsg = false;
    }
    if (isValidMsg && coordsReady) {
      submitButton.disabled = false;
    } else {
      submitButton.disabled = true;
    }
  });
  <script>
  document.getElementById('upload-icon').addEventListener('click', function() {
    document.getElementById('file-input').click();
  });

  document.getElementById('file-input').addEventListener('change', function() {

    var selectedFile = this.files[0];
    console.log('選択されたファイル: ', selectedFile);
  });
</script>

</script>
<style>
  .form-container {
    padding: 16px;
    height: 100vh;
    box-sizing: border-box;
  }
  .form-container > form {
    display: flex;
    flex-direction: column;
    gap: 8px;
    height: 100%;
  }
  .form-header {
    position: sticky;
    top: 0;
    display: flex;
    gap: 16px;
    align-items: center;
    justify-content: end;
    background-color: white;
  }
  #form-cancel-button {
    cursor: pointer;
    margin-right: auto;
    border: none;
    background: none;
    padding: 8px;
    border-radius: 12px;
    color: black;
  }
  #form-cancel-button:hover {
    text-decoration: underline;
  }
  #form-notice {
    font-size: 12px;
    color: gray;
    animation: loading-anm 1s infinite;
  }
  #form-submit-button {
    cursor: pointer;
    width: 40px;
    height: 40px;
    border-radius: 12px;
    display: grid;
    place-content: center;
    background: var(--primary);
    color: var(--white);
    border: none;
  }
  #form-submit-button[disabled] {
    background: var(--primary-dark);
    color: #dedede;
  }
  #form-submit-button svg {
    width: 100%;
    height: 100%;
  }

  .form-main{
    display: flex;
    gap: 8px;
    height: 100%;
  }
  .form-main > svg {
    color: gray;
    width: 44px;
    height: 44px;
  }
  .form-message-wrapper {
    display: flex;
    flex-direction: column;
    gap: 12px;
    flex-grow: 1;
  }
  .form-user-address {
    display: flex;
    align-items: center;
    font-size: 14px;
    color: gray;
    padding: 4px 14px;
    background: #eeeeee;
    align-self: start;
    border-radius: 999px;
    font-weight: bold;
  }
  .form-user-address svg {
    width: 20px;
    height: 20px;
    margin-right: 4px;
    animation: rotate 4s infinite;
  }
  #form-message {
    padding: 0px;
    resize: none;
    font-size: 1rem;
    width: 100%;
    box-sizing: border-box;
    flex-grow: 1;
    border: none !important;
    outline: none !important;
  }

  @keyframes loading-anm {
    0% {
      opacity: 0.5;
    }
    50% {
      opacity: 1;
    }
    100% {
      opacity: 0.5;
    }
  }

  @keyframes rotate {
    0% {
      transform: rotateY(0deg);
    }
    50% {
      transform: rotateY(180deg);
    }
    100% {
      transform: rotateY(360deg);
    }
  }
  #upload-icon {
    cursor: pointer;
    background-color: white;
    color: #ffcc99;
    padding: 10px 20px;
    border-radius: 5px;
  }  
</style>
